<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Goal Tracker</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            width: 100%;
            min-height: 100vh;
            overflow-x: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
            background-attachment: fixed;
        }
        
        #app {
            width: 100%;
            min-height: 100vh;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 4px; }
        
        @keyframes slideIn { 
            from { opacity: 0; transform: translateY(-20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        .success-toast { animation: slideIn 0.3s ease-out; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: #10b981;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 50%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        #targetCountInput {
            display: none;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script type="module">
        const Icons = {
            Plus: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>`,
            Download: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>`,
            Upload: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>`,
            Trash: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>`,
            Target: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>`,
            Check: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m9 12 2 2 4-4"/></svg>`,
            Save: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>`,
            Sparkles: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>`,
            Calendar: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>`,
            Zap: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>`,
            Award: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>`,
            Trend: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>`,
            User: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`,
            Database: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>`
        };

        class GoalTracker {
            constructor() {
                this.userName = localStorage.getItem('userName') || '';
                this.goals = JSON.parse(localStorage.getItem('currentGoals')) || [
                    { id: 1, name: 'Morning Exercise', completed: false, category: 'Health', frequency: 'daily', weeklyProgress: 0, targetCount: 1 },
                    { id: 2, name: 'Drink 8 Glasses of Water', completed: false, category: 'Health', frequency: 'daily', weeklyProgress: 0, targetCount: 1 },
                    { id: 3, name: 'Gym Workout', completed: false, category: 'Health', frequency: 'weekly', weeklyProgress: 0, targetCount: 4, currentWeek: this.getCurrentWeek() }
                ];
                this.history = JSON.parse(localStorage.getItem('history')) || [];
                this.viewMode = 'week';
                this.categories = ['Health', 'Work', 'Personal', 'Learning', 'Wellness', 'Finance', 'School'];
                this.init();
            }

            init() {
                if (!this.userName) {
                    this.promptForName();
                }
                this.checkAndResetWeeklyMonthly();
                this.render();
            }

            getCurrentWeek() {
                const now = new Date();
                const start = new Date(now.getFullYear(), 0, 1);
                const diff = now - start;
                const oneWeek = 1000 * 60 * 60 * 24 * 7;
                return Math.floor(diff / oneWeek);
            }

            getCurrentMonth() {
                return new Date().getMonth();
            }

            checkAndResetWeeklyMonthly() {
                const currentWeek = this.getCurrentWeek();
                const currentMonth = this.getCurrentMonth();
                let needsSave = false;

                this.goals.forEach(goal => {
                    if (goal.frequency === 'weekly' && goal.currentWeek !== currentWeek) {
                        goal.weeklyProgress = 0;
                        goal.currentWeek = currentWeek;
                        needsSave = true;
                    }
                    if (goal.frequency === 'monthly' && goal.currentMonth !== currentMonth) {
                        goal.weeklyProgress = 0;
                        goal.currentMonth = currentMonth;
                        needsSave = true;
                    }
                });

                if (needsSave) {
                    this.save();
                }
            }

            promptForName() {
                const name = prompt("Welcome! What's your name?");
                if (name && name.trim()) {
                    this.userName = name.trim();
                    localStorage.setItem('userName', this.userName);
                }
            }

            getGreeting() {
                const hour = new Date().getHours();
                if (hour < 12) return 'Good Morning';
                if (hour < 18) return 'Good Afternoon';
                return 'Good Evening';
            }

            getDailyCompletionRate() {
                const dailyGoals = this.goals.filter(g => g.frequency === 'daily');
                if (dailyGoals.length === 0) return 0;
                const completed = dailyGoals.filter(g => g.completed).length;
                return Math.round((completed / dailyGoals.length) * 100);
            }

            getWeeklyCompletionRate() {
                const weeklyGoals = this.goals.filter(g => g.frequency === 'weekly');
                if (weeklyGoals.length === 0) return 0;
                let totalProgress = 0;
                let totalTarget = 0;
                weeklyGoals.forEach(g => {
                    totalTarget += g.targetCount || 1;
                    totalProgress += g.weeklyProgress || 0;
                });
                return totalTarget > 0 ? Math.round((totalProgress / totalTarget) * 100) : 0;
            }

            getMonthlyCompletionRate() {
                const monthlyGoals = this.goals.filter(g => g.frequency === 'monthly');
                if (monthlyGoals.length === 0) return 0;
                let totalProgress = 0;
                let totalTarget = 0;
                monthlyGoals.forEach(g => {
                    totalTarget += g.targetCount || 1;
                    totalProgress += g.weeklyProgress || 0;
                });
                return totalTarget > 0 ? Math.round((totalProgress / totalTarget) * 100) : 0;
            }

            getStreak() {
                let streak = 0;
                const sorted = [...this.history].sort((a, b) => b.timestamp - a.timestamp);
                for (let day of sorted) {
                    if ((day.dailyRate || 0) >= 80) streak++;
                    else break;
                }
                return streak;
            }

            getAnalytics() {
                const now = Date.now();
                const day = 24 * 60 * 60 * 1000;
                let days = this.history;
                
                if (this.viewMode === 'week') days = this.history.filter(h => now - h.timestamp < 7 * day);
                else if (this.viewMode === 'month') days = this.history.filter(h => now - h.timestamp < 30 * day);
                else if (this.viewMode === 'year') days = this.history.filter(h => now - h.timestamp < 365 * day);

                const goalStats = {};
                days.forEach(d => {
                    d.goals.forEach(g => {
                        if (!goalStats[g.name]) goalStats[g.name] = { completed: 0, total: 0 };
                        goalStats[g.name].total++;
                        if (g.completed || (g.weeklyProgress >= (g.targetCount || 1))) goalStats[g.name].completed++;
                    });
                });

                const performance = Object.keys(goalStats).map(name => ({
                    name,
                    rate: goalStats[name].total > 0 ? Math.round((goalStats[name].completed / goalStats[name].total) * 100) : 0,
                    completed: goalStats[name].completed,
                    total: goalStats[name].total
                })).sort((a, b) => a.rate - b.rate);

                const avgDaily = days.length > 0 ? Math.round(days.reduce((sum, d) => sum + (d.dailyRate || 0), 0) / days.length) : 0;
                const perfectDays = days.filter(d => (d.dailyRate || 0) === 100).length;
                
                const trendData = days.slice(-14).map(d => ({
                    date: d.date,
                    dailyRate: d.dailyRate || 0,
                    weeklyRate: d.weeklyRate || 0,
                    monthlyRate: d.monthlyRate || 0
                }));

                return { performance, avgDaily, perfectDays, daysTracked: days.length, trendData };
            }

            addGoal(name, category, frequency, targetCount) {
                if (name.trim()) {
                    const goal = {
                        id: Date.now(),
                        name: name.trim(),
                        completed: false,
                        category,
                        frequency: frequency || 'daily',
                        weeklyProgress: 0,
                        targetCount: targetCount || 1
                    };

                    if (frequency === 'weekly') {
                        goal.currentWeek = this.getCurrentWeek();
                    } else if (frequency === 'monthly') {
                        goal.currentMonth = this.getCurrentMonth();
                    }

                    this.goals.push(goal);
                    this.save();
                    this.render();
                }
            }

            toggleGoal(id) {
                const goal = this.goals.find(g => g.id === id);
                if (goal) {
                    if (goal.frequency === 'daily') {
                        goal.completed = !goal.completed;
                    } else {
                        if (goal.weeklyProgress < (goal.targetCount || 1)) {
                            goal.weeklyProgress++;
                        } else {
                            goal.weeklyProgress = 0;
                        }
                    }

                    this.save();
                    const dailyRate = this.getDailyCompletionRate();
                    if (dailyRate === 100) {
                        this.showSuccess('All daily goals complete! ðŸŽ‰');
                    }
                    this.render();
                }
            }

            deleteGoal(id) {
                if (confirm('Delete this goal?')) {
                    this.goals = this.goals.filter(g => g.id !== id);
                    this.save();
                    this.render();
                }
            }

            saveDay() {
                const today = new Date().toLocaleDateString();
                const dayData = {
                    date: today,
                    goals: this.goals.map(g => ({
                        name: g.name,
                        completed: g.completed,
                        category: g.category,
                        frequency: g.frequency,
                        targetCount: g.targetCount,
                        weeklyProgress: g.weeklyProgress
                    })),
                    dailyRate: this.getDailyCompletionRate(),
                    weeklyRate: this.getWeeklyCompletionRate(),
                    monthlyRate: this.getMonthlyCompletionRate(),
                    timestamp: Date.now()
                };

                const existingIndex = this.history.findIndex(h => h.date === today);
                if (existingIndex >= 0) {
                    this.history[existingIndex] = dayData;
                } else {
                    this.history.push(dayData);
                }

                this.history = this.history.slice(-365);
                localStorage.setItem('history', JSON.stringify(this.history));
                this.showSuccess('Day saved! ðŸŽ‰');
                
                this.goals.forEach(g => {
                    if (g.frequency === 'daily') {
                        g.completed = false;
                    }
                });
                this.save();
                this.render();
            }

            resetDay() {
                if (confirm('Reset all goals for today?')) {
                    this.goals.forEach(g => {
                        if (g.frequency === 'daily') {
                            g.completed = false;
                        }
                    });
                    this.save();
                    this.render();
                }
            }

            save() {
                localStorage.setItem('currentGoals', JSON.stringify(this.goals));
            }

            exportCSV() {
                const rows = [['Date', 'Goal', 'Category', 'Frequency', 'Target', 'Progress', 'Daily Rate', 'Weekly Rate', 'Monthly Rate']];
                this.history.forEach(day => {
                    day.goals.forEach(goal => {
                        const progress = goal.frequency === 'daily' ? (goal.completed ? 'Yes' : 'No') : `${goal.weeklyProgress || 0}/${goal.targetCount || 1}`;
                        rows.push([
                            day.date,
                            goal.name,
                            goal.category || 'Uncategorized',
                            goal.frequency || 'daily',
                            goal.targetCount || 1,
                            progress,
                            `${day.dailyRate || 0}%`,
                            `${day.weeklyRate || 0}%`,
                            `${day.monthlyRate || 0}%`
                        ]);
                    });
                });

                const csv = rows.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `goal-tracker-${Date.now()}.csv`;
                a.click();
            }

            exportBackup() {
                const backup = {
                    version: '1.0',
                    exportDate: new Date().toISOString(),
                    userName: this.userName,
                    goals: this.goals,
                    history: this.history
                };

                const json = JSON.stringify(backup, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `goal-tracker-backup-${Date.now()}.json`;
                a.click();
                this.showSuccess('Backup downloaded! ðŸ’¾');
            }

            importBackup() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const backup = JSON.parse(event.target.result);
                            
                            if (!backup.version || !backup.goals || !backup.history) {
                                throw new Error('Invalid backup file format');
                            }

                            if (confirm('This will replace all your current data. Continue?')) {
                                this.userName = backup.userName || this.userName;
                                this.goals = backup.goals;
                                this.history = backup.history;
                                
                                localStorage.setItem('userName', this.userName);
                                localStorage.setItem('currentGoals', JSON.stringify(this.goals));
                                localStorage.setItem('history', JSON.stringify(this.history));
                                
                                this.showSuccess('Data restored successfully! ðŸŽ‰');
                                this.render();
                            }
                        } catch (error) {
                            alert('Error reading backup file. Please make sure it\'s a valid backup file.');
                            console.error(error);
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            }

            showSuccess(msg = 'Success!') {
                const toast = document.getElementById('success-toast');
                if (toast) {
                    toast.innerHTML = `<div class="flex items-center gap-3">${Icons.Sparkles}<span class="font-semibold">${msg}</span></div>`;
                    toast.classList.remove('hidden');
                    setTimeout(() => toast.classList.add('hidden'), 2000);
                }
            }

            getCategoryColor(cat) {
                const colors = {
                    Health: 'from-green-400 to-emerald-500',
                    Work: 'from-blue-400 to-indigo-500',
                    Personal: 'from-purple-400 to-pink-500',
                    Learning: 'from-yellow-400 to-orange-500',
                    Wellness: 'from-teal-400 to-cyan-500',
                    Finance: 'from-rose-400 to-red-500',
                    School: 'from-indigo-400 to-blue-500'
                };
                return colors[cat] || 'from-gray-400 to-gray-500';
            }

            renderProgressCircle(rate, label, icon) {
                const radius = 55;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference * (1 - rate / 100);
                const color = rate >= 80 ? '#10b981' : rate >= 50 ? '#f59e0b' : '#ef4444';

                return `
                    <div class="text-center flex flex-col items-center justify-center py-4">
                        <div class="relative w-32 h-32 mx-auto mb-4">
                            <svg class="transform -rotate-90 w-32 h-32">
                                <circle cx="64" cy="64" r="${radius}" stroke="rgba(255,255,255,0.1)" stroke-width="8" fill="none"/>
                                <circle 
                                    cx="64" 
                                    cy="64" 
                                    r="${radius}" 
                                    stroke="${color}" 
                                    stroke-width="8" 
                                    fill="none" 
                                    stroke-dasharray="${circumference}" 
                                    stroke-dashoffset="${offset}" 
                                    stroke-linecap="round" 
                                    style="transition: stroke-dashoffset 0.5s ease;"
                                />
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-white">${rate}%</div>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center justify-center gap-2 text-white/70 mt-2">
                            ${icon}
                            <span class="text-sm font-medium">${label}</span>
                        </div>
                    </div>
                `;
            }

            renderTrendChart(data) {
                if (!data || data.length === 0) {
                    return '<div class="text-center py-12 text-white/50 text-sm">Save more days to see your trend</div>';
                }

                const hasDailyGoals = this.goals.some(g => g.frequency === 'daily');
                const hasWeeklyGoals = this.goals.some(g => g.frequency === 'weekly');
                const hasMonthlyGoals = this.goals.some(g => g.frequency === 'monthly');

                const max = 100;
                const height = 200;
                const width = 100;
                
                const dailyPoints = hasDailyGoals ? data.map((d, i) => {
                    const x = (i / Math.max(data.length - 1, 1)) * width;
                    const y = height - (d.dailyRate / max) * height;
                    return `${x},${y}`;
                }).join(' ') : '';

                const weeklyPoints = hasWeeklyGoals ? data.map((d, i) => {
                    const x = (i / Math.max(data.length - 1, 1)) * width;
                    const y = height - (d.weeklyRate / max) * height;
                    return `${x},${y}`;
                }).join(' ') : '';

                const monthlyPoints = hasMonthlyGoals ? data.map((d, i) => {
                    const x = (i / Math.max(data.length - 1, 1)) * width;
                    const y = height - (d.monthlyRate / max) * height;
                    return `${x},${y}`;
                }).join(' ') : '';

                return `
                    <div class="mb-4">
                        <div class="flex gap-4 text-xs flex-wrap">
                            ${hasDailyGoals ? '<div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-gradient-to-r from-purple-500 to-pink-500"></div><span class="text-white/70">Daily</span></div>' : ''}
                            ${hasWeeklyGoals ? '<div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-gradient-to-r from-blue-500 to-cyan-500"></div><span class="text-white/70">Weekly</span></div>' : ''}
                            ${hasMonthlyGoals ? '<div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-gradient-to-r from-orange-500 to-yellow-500"></div><span class="text-white/70">Monthly</span></div>' : ''}
                        </div>
                    </div>
                    <svg viewBox="0 0 ${width} ${height}" class="w-full" style="height: 200px;">
                        <defs>
                            <linearGradient id="dailyGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#a855f7;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="weeklyGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#06b6d4;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="monthlyGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#f97316;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#eab308;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        
                        <line x1="0" y1="${height * 0.25}" x2="${width}" y2="${height * 0.25}" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                        <line x1="0" y1="${height * 0.5}" x2="${width}" y2="${height * 0.5}" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                        <line x1="0" y1="${height * 0.75}" x2="${width}" y2="${height * 0.75}" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                        
                        ${hasMonthlyGoals ? `
                        <polyline fill="none" stroke="url(#monthlyGradient)" stroke-width="3" points="${monthlyPoints}"/>
                        ${data.map((d, i) => {
                            const x = (i / Math.max(data.length - 1, 1)) * width;
                            const y = height - (d.monthlyRate / max) * height;
                            return `<circle cx="${x}" cy="${y}" r="3" fill="#eab308"/>`;
                        }).join('')}
                        ` : ''}
                        
                        ${hasWeeklyGoals ? `
                        <polyline fill="none" stroke="url(#weeklyGradient)" stroke-width="3" points="${weeklyPoints}"/>
                        ${data.map((d, i) => {
                            const x = (i / Math.max(data.length - 1, 1)) * width;
                            const y = height - (d.weeklyRate / max) * height;
                            return `<circle cx="${x}" cy="${y}" r="3" fill="#06b6d4"/>`;
                        }).join('')}
                        ` : ''}
                        
                        ${hasDailyGoals ? `
                        <polyline fill="none" stroke="url(#dailyGradient)" stroke-width="3" points="${dailyPoints}"/>
                        ${data.map((d, i) => {
                            const x = (i / Math.max(data.length - 1, 1)) * width;
                            const y = height - (d.dailyRate / max) * height;
                            return `<circle cx="${x}" cy="${y}" r="3" fill="#ec4899"/>`;
                        }).join('')}
                        ` : ''}
                    </svg>
                `;
            }

            editName() {
                const newName = prompt("Change your name:", this.userName);
                if (newName && newName.trim()) {
                    this.userName = newName.trim();
                    localStorage.setItem('userName', this.userName);
                    this.render();
                }
            }

            updateFrequencyVisibility() {
                const freq = document.getElementById('frequencySelect')?.value;
                const targetInput = document.getElementById('targetCountInput');
                if (targetInput) {
                    targetInput.style.display = (freq === 'weekly' || freq === 'monthly') ? 'block' : 'none';
                }
            }

            render() {
                const dailyRate = this.getDailyCompletionRate();
                const weeklyRate = this.getWeeklyCompletionRate();
                const monthlyRate = this.getMonthlyCompletionRate();
                const analytics = this.getAnalytics();
                const streak = this.getStreak();
                const greeting = this.getGreeting();

                const hasDailyGoals = this.goals.some(g => g.frequency === 'daily');
                const hasWeeklyGoals = this.goals.some(g => g.frequency === 'weekly');
                const hasMonthlyGoals = this.goals.some(g => g.frequency === 'monthly');

                const dailyComplete = this.goals.filter(g => g.frequency === 'daily' && g.completed).length;
                const dailyTotal = this.goals.filter(g => g.frequency === 'daily').length;

                document.getElementById('app').innerHTML = `
                    <div id="success-toast" class="hidden fixed top-8 right-4 left-4 md:left-auto md:w-auto bg-gradient-to-r from-green-400 to-emerald-500 text-white px-6 py-4 rounded-2xl shadow-2xl z-50 success-toast"></div>

                    <div class="min-h-screen pb-8">
                        <div class="px-4 md:px-8 pt-6 pb-4">
                            <div class="flex items-center justify-between mb-2 flex-wrap gap-3">
                                <div>
                                    <h1 class="text-3xl md:text-4xl font-bold gradient-text">${greeting}${this.userName ? ', ' + this.userName : ''}!</h1>
                                    <p class="text-purple-300 text-sm mt-1">${new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}</p>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="tracker.importBackup()" class="p-3 rounded-xl bg-white/10 hover:bg-white/20 transition-all text-white" title="Import Backup">
                                        ${Icons.Upload}
                                    </button>
                                    <button onclick="tracker.exportBackup()" class="p-3 rounded-xl bg-white/10 hover:bg-white/20 transition-all text-white" title="Export Backup">
                                        ${Icons.Database}
                                    </button>
                                    <button onclick="tracker.editName()" class="p-3 rounded-xl bg-white/10 hover:bg-white/20 transition-all text-white" title="Change Name">
                                        ${Icons.User}
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="px-4 md:px-8 mb-6">
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                ${hasDailyGoals ? `
                                <div class="glass-card rounded-2xl p-4">
                                    <div class="flex items-center gap-2 mb-2 text-white/70">
                                        ${Icons.Check}
                                        <span class="text-xs font-medium">Daily</span>
                                    </div>
                                    <div class="text-3xl font-bold text-white mb-1">${dailyRate}%</div>
                                    <div class="text-xs text-white/50">${dailyComplete}/${dailyTotal} today</div>
                                </div>
                                ` : ''}
                                <div class="glass-card rounded-2xl p-4">
                                    <div class="flex items-center gap-2 mb-2 text-white/70">
                                        ${Icons.Zap}
                                        <span class="text-xs font-medium">Streak</span>
                                    </div>
                                    <div class="text-3xl font-bold text-white mb-1">${streak}</div>
                                    <div class="text-xs text-white/50">${streak === 1 ? 'day' : 'days'} 80%+</div>
                                </div>
                                <div class="glass-card rounded-2xl p-4">
                                    <div class="flex items-center gap-2 mb-2 text-white/70">
                                        ${Icons.Award}
                                        <span class="text-xs font-medium">Perfect</span>
                                    </div>
                                    <div class="text-3xl font-bold text-white mb-1">${analytics.perfectDays}</div>
                                    <div class="text-xs text-white/50">${analytics.perfectDays === 1 ? 'day' : 'days'} 100%</div>
                                </div>
                            </div>
                        </div>

                        <div class="px-4 md:px-8 mb-6">
                            <div class="grid ${hasDailyGoals && hasWeeklyGoals && hasMonthlyGoals ? 'lg:grid-cols-4' : (hasDailyGoals && hasWeeklyGoals) || (hasDailyGoals && hasMonthlyGoals) || (hasWeeklyGoals && hasMonthlyGoals) ? 'lg:grid-cols-3' : 'lg:grid-cols-3'} gap-4">
                                <div class="${(hasDailyGoals || hasWeeklyGoals || hasMonthlyGoals) ? 'lg:col-span-2' : 'lg:col-span-3'} glass-card rounded-3xl p-5">
                                    <div class="flex items-center justify-between mb-5">
                                        <h2 class="text-xl font-bold text-white flex items-center gap-2">
                                            ${Icons.Check}
                                            <span>Goals</span>
                                        </h2>
                                        <div class="flex gap-2">
                                            <button onclick="tracker.resetDay()" class="text-white/50 hover:text-white/80 transition-colors text-sm px-3 py-1.5 rounded-lg hover:bg-white/10">
                                                Reset
                                            </button>
                                            <button onclick="tracker.saveDay()" class="flex items-center gap-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-4 py-1.5 rounded-xl hover:shadow-lg transition-all text-sm font-medium">
                                                ${Icons.Save}
                                                Save
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <div class="flex gap-2 flex-wrap mb-2">
                                            <input 
                                                id="goalInput" 
                                                type="text" 
                                                placeholder="Add a new goal..." 
                                                class="flex-1 min-w-[180px] px-4 py-3 bg-white/10 backdrop-blur-lg border border-white/20 rounded-xl text-white placeholder-white/50 focus:border-purple-400 focus:outline-none transition-all text-sm"
                                                onkeypress="if(event.key==='Enter') tracker.handleAddGoal()"
                                            >
                                            <select 
                                                id="categorySelect" 
                                                class="px-4 py-3 bg-white/10 backdrop-blur-lg border border-white/20 rounded-xl text-white focus:border-purple-400 focus:outline-none transition-all text-sm"
                                            >
                                                ${this.categories.map(cat => `<option value="${cat}" class="bg-slate-800">${cat}</option>`).join('')}
                                            </select>
                                            <select 
                                                id="frequencySelect" 
                                                class="px-4 py-3 bg-white/10 backdrop-blur-lg border border-white/20 rounded-xl text-white focus:border-purple-400 focus:outline-none transition-all text-sm"
                                                onchange="tracker.updateFrequencyVisibility()"
                                            >
                                                <option value="daily" class="bg-slate-800">Daily</option>
                                                <option value="weekly" class="bg-slate-800">Weekly</option>
                                                <option value="monthly" class="bg-slate-800">Monthly</option>
                                            </select>
                                            <button 
                                                onclick="tracker.handleAddGoal()" 
                                                class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-3 rounded-xl hover:shadow-lg transition-all"
                                            >
                                                ${Icons.Plus}
                                            </button>
                                        </div>
                                        <input 
                                            id="targetCountInput" 
                                            type="number" 
                                            min="1" 
                                            max="30" 
                                            value="4"
                                            placeholder="How many times?" 
                                            class="w-full px-4 py-3 bg-white/10 backdrop-blur-lg border border-white/20 rounded-xl text-white placeholder-white/50 focus:border-purple-400 focus:outline-none transition-all text-sm"
                                            style="display: none;"
                                        >
                                    </div>

                                    <div class="space-y-2 max-h-[450px] overflow-y-auto">
                                        ${this.goals.map(goal => {
                                            const isComplete = goal.frequency === 'daily' 
                                                ? goal.completed 
                                                : goal.weeklyProgress >= (goal.targetCount || 1);

                                            return `
                                            <div class="group rounded-xl border transition-all ${isComplete ? 'bg-gradient-to-r from-green-500/20 to-emerald-500/20 border-green-500/40' : 'bg-white/5 border-white/10 hover:border-purple-400/50'} p-3">
                                                <div class="flex items-center gap-3">
                                                    <button 
                                                        onclick="tracker.toggleGoal(${goal.id})" 
                                                        class="w-6 h-6 shrink-0 rounded-lg border-2 ${isComplete ? 'bg-green-500 border-green-500' : 'border-white/40'} flex items-center justify-center text-white font-bold text-sm transition-all hover:scale-110"
                                                    >
                                                        ${goal.frequency === 'daily' ? (goal.completed ? 'âœ“' : '') : (goal.weeklyProgress || 0)}
                                                    </button>
                                                    <div class="flex-1 min-w-0">
                                                        <div class="text-base font-medium ${isComplete ? 'line-through text-white/50' : 'text-white'} mb-1">${goal.name}</div>
                                                        <div class="flex gap-2 flex-wrap">
                                                            <span class="inline-block px-2 py-0.5 rounded-full text-xs font-medium bg-gradient-to-r ${this.getCategoryColor(goal.category)} text-white">${goal.category}</span>
                                                            <span class="inline-block px-2 py-0.5 rounded-full text-xs font-medium bg-white/20 text-white/90">
                                                                ${goal.frequency === 'daily' ? 'Daily' : `${goal.targetCount}x/${goal.frequency}`}
                                                            </span>
                                                            ${goal.frequency !== 'daily' ? `<span class="inline-block px-2 py-0.5 rounded-full text-xs font-medium ${isComplete ? 'bg-green-500/50' : 'bg-orange-500/50'} text-white">${goal.weeklyProgress || 0}/${goal.targetCount || 1}</span>` : ''}
                                                        </div>
                                                    </div>
                                                    <button 
                                                        onclick="tracker.deleteGoal(${goal.id})" 
                                                        class="opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-300 transition-all p-2 shrink-0"
                                                    >
                                                        ${Icons.Trash}
                                                    </button>
                                                </div>
                                            </div>
                                        `}).join('')}
                                        ${this.goals.length === 0 ? `
                                            <div class="text-center py-16 text-white/50">
                                                <div class="mb-4 opacity-50 flex justify-center">${Icons.Target}</div>
                                                <p class="text-base">Add your first goal above</p>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>

                                ${hasDailyGoals ? `
                                <div class="glass-card rounded-3xl p-5 flex flex-col">
                                    <h2 class="text-xl font-bold text-white mb-3">Daily Progress</h2>
                                    <div class="flex-1 flex items-center justify-center">
                                        ${this.renderProgressCircle(dailyRate, 'Today', Icons.Check)}
                                    </div>
                                </div>
                                ` : ''}

                                ${hasWeeklyGoals ? `
                                <div class="glass-card rounded-3xl p-5 flex flex-col">
                                    <h2 class="text-xl font-bold text-white mb-3">Weekly Progress</h2>
                                    <div class="flex-1 flex items-center justify-center">
                                        ${this.renderProgressCircle(weeklyRate, 'This Week', Icons.Calendar)}
                                    </div>
                                </div>
                                ` : ''}

                                ${hasMonthlyGoals ? `
                                <div class="glass-card rounded-3xl p-5 flex flex-col">
                                    <h2 class="text-xl font-bold text-white mb-3">Monthly Progress</h2>
                                    <div class="flex-1 flex items-center justify-center">
                                        ${this.renderProgressCircle(monthlyRate, 'This Month', Icons.Calendar)}
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>

                        ${this.history.length > 0 ? `
                            <div class="px-4 md:px-8 mb-4">
                                <div class="flex gap-2 flex-wrap">
                                    ${['week', 'month', 'year'].map(mode => `
                                        <button 
                                            onclick="tracker.setViewMode('${mode}')" 
                                            class="px-5 py-2 rounded-xl font-medium transition-all text-sm ${this.viewMode === mode ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg' : 'bg-white/10 text-white/70 hover:bg-white/20 border border-white/10'}"
                                        >
                                            ${mode.charAt(0).toUpperCase() + mode.slice(1)}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>

                            <div class="px-4 md:px-8">
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div class="glass-card rounded-3xl p-5">
                                        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                            ${Icons.Trend}
                                            Progress Over Time
                                        </h3>
                                        ${this.renderTrendChart(analytics.trendData)}
                                    </div>

                                    <div class="glass-card rounded-3xl p-5">
                                        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                            ${Icons.Target}
                                            Goals to Focus On
                                        </h3>
                                        <div class="space-y-3 max-h-[250px] overflow-y-auto">
                                            ${analytics.performance.slice(0, 5).map(goal => `
                                                <div class="bg-white/5 rounded-xl p-3 border border-white/10">
                                                    <div class="flex justify-between items-center mb-2">
                                                        <span class="font-medium text-white text-sm truncate flex-1 mr-2">${goal.name}</span>
                                                        <span class="font-bold ${goal.rate < 50 ? 'text-red-400' : goal.rate < 75 ? 'text-orange-400' : 'text-green-400'} shrink-0">${goal.rate}%</span>
                                                    </div>
                                                    <div class="w-full bg-white/10 rounded-full h-2">
                                                        <div 
                                                            class="h-2 rounded-full transition-all bg-gradient-to-r ${goal.rate < 50 ? 'from-red-500 to-red-600' : goal.rate < 75 ? 'from-orange-500 to-yellow-500' : 'from-green-500 to-emerald-500'}" 
                                                            style="width: ${goal.rate}%"
                                                        ></div>
                                                    </div>
                                                    <p class="text-xs text-white/50 mt-1">${goal.completed}/${goal.total} completed</p>
                                                </div>
                                            `).join('')}
                                            ${analytics.performance.length === 0 ? '<div class="text-center py-8 text-white/50 text-sm">No data yet</div>' : ''}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            handleAddGoal() {
                const input = document.getElementById('goalInput');
                const select = document.getElementById('categorySelect');
                const frequencySelect = document.getElementById('frequencySelect');
                const targetCountInput = document.getElementById('targetCountInput');
                
                if (input && select && frequencySelect) {
                    const frequency = frequencySelect.value;
                    const targetCount = (frequency === 'weekly' || frequency === 'monthly') 
                        ? parseInt(targetCountInput?.value || 1) 
                        : 1;
                    
                    this.addGoal(input.value, select.value, frequency, targetCount);
                    input.value = '';
                    targetCountInput.value = '4';
                    targetCountInput.style.display = 'none';
                    frequencySelect.value = 'daily';
                }
            }

            setViewMode(mode) {
                this.viewMode = mode;
                this.render();
            }
        }

        window.tracker = new GoalTracker();
    </script>
</body>
</html>
